import gzip
import pytest
from pathlib import Path


def setup_illumina_dir(fp: Path, r1: str, r1_lines: list[str]) -> Path:
    fp.mkdir(parents=True, exist_ok=True)

    r1_fp = fp / r1
    with gzip.open(r1_fp, "wt") as f:
        f.writelines(r1_lines)

    (fp / r1.replace("R1", "R2")).touch()
    (fp / r1.replace("R1", "I1")).touch()
    (fp / r1.replace("R1", "I2")).touch()
    (fp / "sample_sheet.csv").touch()

    return fp


@pytest.fixture
def novaseq_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "250218_A00901_1295_BHTKCGDRX5",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@A00901:1295:HTKCGDRX5:1:2101:1054:1000 1:N:0:NAGTGTTAGG+CGGAACTAGC\n",
            "GTAAAAAGCTAGATTTTCGCGATTTACCAGACGAACTANTNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN\n",
            "+\n",
            "FFFFF,FFF:FFFFFF,FFFFFFFFFFFFFFFFFFFFF#,###############################################################################################################\n",
            "@A00901:1295:HTKCGDRX5:1:2101:1090:1000 1:N:0:AATTCTTGGA+AAGTTGACAA\n",
            "GCTGCAATATGCGCCAACAAAACCGGTGGATAAAAAGGTTTCGTAATATAGTCATCNCNGNCNTNTNCNANNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNATTTCTCCGC\n",
            "+\n",
            ",FFFFFFFF:FFFFFFFFFFFF::FFFFFFFFF,FFFFFFF:F::FFFFFFFFFF:#F#F#F#F#:#F#F#######################################################################FFFFFFFFFF\n",
        ],
    )


@pytest.fixture
def hiseq_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "201118_D00728_0139_ACD5C3ANXX",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@D00728:139:CD5C3ANXX:1:1101:1228:2123 1:N:0:ATCTCAGG+CCTAGAGT\n",
            "NTGCGCAGGGGGACCTGCACCGGCATCCCCTGTACCGGCGGGGCGCTCAGGCTGAATGCGCCGTCCTGCATCAGTACCGACTCCGGCTCGATGGCTTTATCCTGTCTCTTATACACATCTCCGAGC\n",
            "+\n",
            "#:<>AE<EGGGGCGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGEGGGGGGGGGGGGGGEGGGGDEGGGGGGGGGG;EGGGGGGEDDEGGGGGGGGGGGGGGBEGGDDDCDC\n",
            "@D00728:139:CD5C3ANXX:1:1101:1176:2132 1:N:0:CTCTCTAC+TTCTAGCT\n",
            "NATCTCGACCTTTTGGGTCAGTCCGTTTTTCGATTTATAAACCGCCGGCAATACACGGCTCTTGACATCCGATAATCCCGGAGACGCATGGACCGACAATGTCCCAATCCTGTCTCTTATACACAT\n",
            "+\n",
            "#<<>BGGGGGGGGGDDG=CGGGGF=FGGGGGGGGGGGGGGGGF<EG@EEGGCGGGGGGGGDGGGGEGGGGGGGDGGGGGBGGGGGGGGBGGGGEGGGGG77CEEE=GGG.DGDEGEGGB/8/CDB@\n",
        ],
    )


@pytest.fixture
def novaseqx_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "20250429_LH00732_0028_A22YJWWLT3",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@LH00732:28:22YJWWLT3:1:1101:1213:1080 1:N:0:CCTCCGTCCA+CACCGATGTG\n",
            "ACGT\n",
            "+\n",
            "IIII\n",
        ],
    )


@pytest.fixture
def miseq_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:1:1101:16223:1348 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTT\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3A333BB33B311100BA000BBBE122B110A//AA/>//>///>///<<<//<<--<---:------9---99-999-9---9-99-99---9----9-9-999-9-9-9-----999--9--9--99-9/99/9/--99---999-9-999--9--999-9-9-9-99-9--9-999-99-999999999@>-9-99--99---999--999@999-9999@>---9------9-9\n",
            "@M03543:443:000000000-DTHBL:1:1101:15497:1351 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTC\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3B333BB33B311100BB000BBCD122B110A//AA/>//>///>////<<//<<--<-:-:-9--9-9---9--999--///9//9/99--------9-9-9999999-9-----999-----9--99-9/99/9/--99-9--99-9-999--9--9-9--9--9-99-9----999-99-9999999999@9--99--99---99---999@999--999=>---9------9-9\n",
        ],
    )


@pytest.fixture
def miniseq_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "210612_NB551353_0107_AHWJFCAFX2",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@NB551353:107:HWJFCAFX2:1:11101:1486:1048 1:N:0:TAATTAGCGT+NNNTTAACCA\n",
            "GAAATNGACCGCCTCAATGAGGTTGCCAAGAATTTAAATGAATCTCTCATCGATCTCCAAGAACTTGGAAAGTA\n",
            "+\n",
            "AAAAA#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEAEEEEEEEEEEEEEEEAEEEEEEEEEEEEEEEE\n",
            "@NB551353:107:HWJFCAFX2:1:11101:6713:1048 1:N:0:GAAGACTAGA+NNNTTCTAGT\n",
            "GGCTANATCTGAGGACAAGAGGGCAAAAGTTACTAGTGCTATGCAGACAATGCTTTTCACTATGCTTAGAAAGT\n",
            "+\n",
            "AAAAA#EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE\n",
        ],
    )


@pytest.fixture
def nextseq_dir(tmp_path) -> Path:
    return setup_illumina_dir(
        tmp_path / "250101_VH12345_0022_222C2NYNX",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@VH12345:22:222C2NYNX:1:1101:18286:1000 1:N:0:GGCACTAAGG+GTTGACCTGA\n",
            "ACGT\n",
            "+\n",
            "IIII\n",
        ],
    )


@pytest.fixture
def full_miseq_dir(tmp_path) -> Path:
    # Lane 1
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L001_R1_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:1:1101:16223:1348 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTT\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3A333BB33B311100BA000BBBE122B110A//AA/>//>///>///<<<//<<--<---:------9---99-999-9---9-99-99---9----9-9-999-9-9-9-----999--9--9--99-9/99/9/--99---999-9-999--9--999-9-9-9-99-9--9-999-99-999999999@>-9-99--99---999--999@999-9999@>---9------9-9\n",
            "@M03543:443:000000000-DTHBL:1:1101:15497:1351 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTC\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3B333BB33B311100BB000BBCD122B110A//AA/>//>///>////<<//<<--<-:-:-9--9-9---9--999--///9//9/99--------9-9-9999999-9-----999-----9--99-9/99/9/--99-9--99-9-999--9--9-9--9--9-99-9----999-99-9999999999@9--99--99---99---999@999--999=>---9------9-9\n",
        ],
    )
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L001_R2_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:1:1101:16223:1348 2:N:0:TTTTTTTTTTTT+TTCTTTTTCCTT\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3A333BB33B311100BA000BBBE122B110A//AA/>//>///>///<<<//<<--<---:------9---99-999-9---9-99-99---9----9-9-999-9-9-9-----999--9--9--99-9/99/9/--99---999-9-999--9--999-9-9-9-99-9--9-999-99-999999999@>-9-99--99---999--999@999-9999@>---9------9-9\n",
            "@M03543:443:000000000-DTHBL:1:1101:15497:1351 2:N:0:TTTTTTTTTTTT+TTCTTTTTCCTC\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3B333BB33B311100BB000BBCD122B110A//AA/>//>///>////<<//<<--<-:-:-9--9-9---9--999--///9//9/99--------9-9-9999999-9-----999-----9--99-9/99/9/--99-9--99-9-999--9--9-9--9--9-99-9----999-99-9999999999@9--99--99---99---999@999--999=>---9------9-9\n",
        ],
    )
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L001_I1_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:1:2106:17605:1940 1:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "111>111>0000\n",
            "@M03543:443:000000000-DTHBL:1:2106:14807:1943 1:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "1>1111>100>0\n",
        ],
    )
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L001_I2_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:1:2106:17605:1940 2:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "111>111>0000\n",
            "@M03543:443:000000000-DTHBL:1:2106:14807:1943 2:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "1>1111>100>0\n",
        ],
    )

    # Lane 2
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L002_R1_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:2:1101:16223:1348 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTT\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3A333BB33B311100BA000BBBE122B110A//AA/>//>///>///<<<//<<--<---:------9---99-999-9---9-99-99---9----9-9-999-9-9-9-----999--9--9--99-9/99/9/--99---999-9-999--9--999-9-9-9-99-9--9-999-99-999999999@>-9-99--99---999--999@999-9999@>---9------9-9\n",
            "@M03543:443:000000000-DTHBL:2:1101:15497:1351 1:N:0:TTTTTTTTTTTT+TTCTTTTTCCTC\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3B333BB33B311100BB000BBCD122B110A//AA/>//>///>////<<//<<--<-:-:-9--9-9---9--999--///9//9/99--------9-9-9999999-9-----999-----9--99-9/99/9/--99-9--99-9-999--9--9-9--9--9-99-9----999-99-9999999999@9--99--99---99---999@999--999=>---9------9-9\n",
        ],
    )
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L002_R2_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:2:1101:16223:1348 2:N:0:TTTTTTTTTTTT+TTCTTTTTCCTT\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3A333BB33B311100BA000BBBE122B110A//AA/>//>///>///<<<//<<--<---:------9---99-999-9---9-99-99---9----9-9-999-9-9-9-----999--9--9--99-9/99/9/--99---999-9-999--9--999-9-9-9-99-9--9-999-99-999999999@>-9-99--99---999--999@999-9999@>---9------9-9\n",
            "@M03543:443:000000000-DTHBL:2:1101:15497:1351 2:N:0:TTTTTTTTTTTT+TTCTTTTTCCTC\n",
            "TCTTCCCTCTTTCTTCTTTCTTCCTCCCTTCCCTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTCTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTTT\n",
            "+\n",
            ">>>>A1C1BB1B3B333BB33B311100BB000BBCD122B110A//AA/>//>///>////<<//<<--<-:-:-9--9-9---9--999--///9//9/99--------9-9-9999999-9-----999-----9--99-9/99/9/--99-9--99-9-999--9--9-9--9--9-99-9----999-99-9999999999@9--99--99---99---999@999--999=>---9------9-9\n",
        ],
    )
    setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L002_I1_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:2:2106:17605:1940 1:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "111>111>0000\n",
            "@M03543:443:000000000-DTHBL:2:2106:14807:1943 1:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "1>1111>100>0\n",
        ],
    )
    return setup_illumina_dir(
        tmp_path / "250407_M03543_0443_000000000-DTHBL",
        "Undetermined_S0_L002_I2_001.fastq.gz",
        [
            "@M03543:443:000000000-DTHBL:2:2106:17605:1940 2:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "111>111>0000\n",
            "@M03543:443:000000000-DTHBL:2:2106:14807:1943 2:N:0:TTTTTTTTTTTT+TCTTTCCCTACA\n",
            "TTTTTTTTTTTT\n",
            "+\n",
            "1>1111>100>0\n",
        ],
    )
